<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.liuvv.com",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1,dimmer:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.json"}</script><meta name="description" content="0. 前言0.0 防火墙 从逻辑上讲，防火墙可以大体分为主机防火墙和网络防火墙。  主机防火墙：针对于单个主机进行防护。  网络防火墙：往往处于网络入口或边缘，针对于网络入口进行防护，服务于防火墙背后的本地局域网。 网络防火墙和主机防火墙并不冲突，可以理解为，网络防火墙主外（集体）， 主机防火墙主内（个人）。  从物理上讲，防火墙可以分为硬件防火墙和软件防火墙。  硬件防火墙：在硬件级别实现部分防"><meta property="og:type" content="article"><meta property="og:title" content="iptables使用教程01"><meta property="og:url" content="https://www.liuvv.com/p/a8480986.html"><meta property="og:site_name" content="Levon&#39;s Blog"><meta property="og:description" content="0. 前言0.0 防火墙 从逻辑上讲，防火墙可以大体分为主机防火墙和网络防火墙。  主机防火墙：针对于单个主机进行防护。  网络防火墙：往往处于网络入口或边缘，针对于网络入口进行防护，服务于防火墙背后的本地局域网。 网络防火墙和主机防火墙并不冲突，可以理解为，网络防火墙主外（集体）， 主机防火墙主内（个人）。  从物理上讲，防火墙可以分为硬件防火墙和软件防火墙。  硬件防火墙：在硬件级别实现部分防"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.liuvv.com/p/a8480986/1.png"><meta property="og:image" content="https://www.liuvv.com/p/a8480986/2.png"><meta property="og:image" content="https://www.liuvv.com/p/a8480986/4.jpg"><meta property="article:published_time" content="2021-12-02T00:00:01.000Z"><meta property="article:modified_time" content="2024-05-29T12:59:19.966Z"><meta property="article:author" content="levon"><meta property="article:tag" content="iptables"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.liuvv.com/p/a8480986/1.png"><link rel="canonical" href="https://www.liuvv.com/p/a8480986.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>iptables使用教程01 | Levon's Blog</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?521e5dbc31dd12bb9431823008da3dfc";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Levon's Blog</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">微信: L6241425</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>日志</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a href="https://github.com/unix2dos" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.liuvv.com/p/a8480986.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="levon"><meta itemprop="description" content="Keep it simple, stupid."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Levon's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">iptables使用教程01</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-12-02 00:00:01" itemprop="dateCreated datePublished" datetime="2021-12-02T00:00:01+00:00">2021-12-02</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-05-29 12:59:19" itemprop="dateModified" datetime="2024-05-29T12:59:19+00:00">2024-05-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-linux%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">2-linux系统</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-linux%E7%B3%BB%E7%BB%9F/iptables/" itemprop="url" rel="index"><span itemprop="name">iptables</span></a> </span></span><span id="/p/a8480986.html" class="post-meta-item leancloud_visitors" data-flag-title="iptables使用教程01" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/p/a8480986.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/p/a8480986.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>9.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>9 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h1><h3 id="0-0-防火墙"><a href="#0-0-防火墙" class="headerlink" title="0.0 防火墙"></a>0.0 防火墙</h3><ul><li><p>从逻辑上讲，防火墙可以大体分为主机防火墙和网络防火墙。</p><ul><li>主机防火墙：针对于单个主机进行防护。</li></ul><p>网络防火墙：往往处于网络入口或边缘，针对于网络入口进行防护，服务于防火墙背后的本地局域网。</p><p>网络防火墙和主机防火墙并不冲突，可以理解为，网络防火墙主外（集体）， 主机防火墙主内（个人）。</p></li><li><p>从物理上讲，防火墙可以分为硬件防火墙和软件防火墙。</p></li><li><p>硬件防火墙：在硬件级别实现部分防火墙功能，另一部分功能基于软件实现，性能高，成本高。</p></li><li><p>软件防火墙：应用软件处理逻辑运行于通用硬件平台之上的防火墙，性能低，成本低。</p></li></ul><span id="more"></span><h3 id="0-1-iptables"><a href="#0-1-iptables" class="headerlink" title="0.1 iptables"></a>0.1 iptables</h3><p>iptables其实不是真正的防火墙，我们可以把它理解成一个客户端代理，用户通过iptables这个代理，将用户的安全设定执行到对应的”安全框架”中，这个”安全框架”才是真正的防火墙，这个框架的名字叫netfilter</p><p>netfilter才是防火墙真正的安全框架（framework），netfilter位于内核空间。iptables其实是一个命令行工具，位于用户空间，我们用这个工具操作真正的框架。</p><p>netfilter&#x2F;iptables（下文中简称为iptables）组成Linux平台下的包过滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，它可以代替昂贵的商业防火墙解决方案，完成封包过滤、封包重定向和网络地址转换（NAT）等功能。</p><h3 id="0-2-netfilter"><a href="#0-2-netfilter" class="headerlink" title="0.2  netfilter"></a>0.2 netfilter</h3><p>netfilter是Linux操作系统核心层内部的一个数据包处理模块，它具有如下功能：</p><ul><li>网络地址转换(Network Address Translate)</li><li>数据包内容修改</li><li>以及数据包过滤的防火墙功能</li></ul><p>所以说，虽然我们使用service iptables start启动iptables”服务”，但是其实准确的来说，iptables并没有一个守护进程，所以并不能算是真正意义上的服务，而应该算是内核提供的功能。</p><h1 id="1-iptables基础"><a href="#1-iptables基础" class="headerlink" title="1. iptables基础"></a>1. iptables基础</h1><p>我们知道iptables是按照规则来办事的，我们就来说说规则（rules），规则其实就是网络管理员预定义的条件，规则一般的定义为”如果数据包头符合这样的条件，就这样处理这个数据包”。</p><p>规则存储在内核空间的信息包过滤表中，这些规则分别指定了源地址、目的地址、传输协议（如TCP、UDP、ICMP）和服务类型（如HTTP、FTP和SMTP）等。</p><p>当数据包与规则匹配时，iptables就根据规则所定义的方法来处理这些数据包，如放行（accept）、拒绝（reject）和丢弃（drop）等。配置防火墙的主要工作就是添加、修改和删除这些规则。</p><h3 id="1-1-五链"><a href="#1-1-五链" class="headerlink" title="1.1 五链"></a>1.1 五链</h3><p><img src="/p/a8480986/1.png" alt="1"></p><ul><li>PREROUTING 数据包刚进入网络层 , 路由之前</li><li>INPUT 路由判断，流入用户空间</li><li>OUTPUT 用户空间发出，后接路由判断出口的网络接口</li><li>FORWARD 路由判断不进入用户空间，只进行转发</li><li>POSTROUTING 数据包通过网络接口出去</li></ul><h5 id="1-1-1-举例"><a href="#1-1-1-举例" class="headerlink" title="1.1.1 举例:"></a>1.1.1 举例:</h5><p>到本机某进程的报文：PREROUTING –&gt; INPUT</p><p>由本机转发的报文：PREROUTING –&gt; FORWARD –&gt; POSTROUTING</p><p>由本机的某进程发出报文（通常为响应报文）：OUTPUT –&gt; POSTROUTING</p><h2 id="1-2-四表"><a href="#1-2-四表" class="headerlink" title="1.2 四表"></a>1.2 四表</h2><p>我们把具有相同功能的规则的集合叫做”表”，所以说，不同功能的规则，我们可以放置在不同的表中进行管理，而iptables已经为我们定义了4种表，每种表对应了不同的功能，而我们定义的规则也都逃脱不了这4种功能的范围，所以，学习iptables之前，我们必须先搞明白每种表 的作用。</p><ul><li>filter表：负责过滤功能，防火墙；内核模块：iptables_filter</li><li>nat表：network address translation，网络地址转换功能；内核模块：iptable_nat</li><li>mangle表：拆解报文，做出修改，并重新封装 的功能；iptable_mangle</li><li>raw表：关闭nat表上启用的连接追踪机制；iptable_raw</li></ul><p>也就是说，我们自定义的所有规则，都是这四种分类中的规则，或者说，所有规则都存在于这4张”表”中。</p><h3 id="1-3-表链关系"><a href="#1-3-表链关系" class="headerlink" title="1.3 表链关系"></a>1.3 表链关系</h3><table><thead><tr><th>四表&#x2F;五链</th><th>PREROUTING</th><th>INPUT</th><th>FORWARD</th><th>OUTPUT</th><th>POSTROUTING</th></tr></thead><tbody><tr><td>filter</td><td></td><td>√</td><td>√</td><td>√</td><td></td></tr><tr><td>nat</td><td>√</td><td>√(centos7)</td><td></td><td>√</td><td>√</td></tr><tr><td>mangle</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>raw</td><td>√</td><td></td><td></td><td>√</td><td></td></tr></tbody></table><p>表的优先级关系: raw –&gt; mangle –&gt; nat –&gt; filter , raw 最高</p><p><img src="/p/a8480986/2.png" alt="1"></p><p><img src="/p/a8480986/4.jpg" alt="1"></p><h1 id="2-规则"><a href="#2-规则" class="headerlink" title="2. 规则"></a>2. 规则</h1><p>规则是根据指定的匹配条件来尝试匹配每个流经此处的报文，一旦匹配成功，则由规则后面指定的处理动作进行处理；</p><h3 id="2-1-匹配条件"><a href="#2-1-匹配条件" class="headerlink" title="2.1 匹配条件"></a>2.1 匹配条件</h3><p>匹配条件分为基本匹配条件与扩展匹配条件</p><ul><li>基本匹配条件：<br>源地址Source IP，目标地址 Destination IP<br>上述内容都可以作为基本匹配条件。</li><li>扩展匹配条件：<br>除了上述的条件可以用于匹配，还有很多其他的条件可以用于匹配，这些条件泛称为扩展条件，这些扩展条件其实也是netfilter中的一部分，只是以模块的形式存在，如果想要使用这些条件，则需要依赖对应的扩展模块。<br>源端口Source Port, 目标端口Destination Port<br>上述内容都可以作为扩展匹配条件</li></ul><h3 id="2-2-处理动作"><a href="#2-2-处理动作" class="headerlink" title="2.2 处理动作"></a>2.2 处理动作</h3><p>处理动作在iptables中被称为target（这样说并不准确，我们暂且这样称呼），动作也可以分为基本动作和扩展动作。<br>此处列出一些常用的动作，之后的文章会对它们进行详细的示例与总结：</p><ul><li>ACCEPT：允许数据包通过。</li><li>DROP：直接丢弃数据包，不给任何回应信息，这时候客户端会感觉自己的请求泥牛入海了，过了超时时间才会有反应。</li><li>REJECT：拒绝数据包通过，必要时会给数据发送端一个响应的信息，客户端刚请求就会收到拒绝的信息。</li><li>SNAT：源地址转换，解决内网用户用同一个公网地址上网的问题。</li><li>MASQUERADE：是SNAT的一种特殊形式，适用于动态的、临时会变的ip上。</li><li>DNAT：目标地址转换。</li><li>REDIRECT：在本机做端口映射。</li><li>LOG：在&#x2F;var&#x2F;log&#x2F;messages文件中记录日志信息，然后将数据包传递给下一条规则，也就是说除了记录以外不对数据包做任何其他操作，仍然让下一条规则去匹配。</li></ul><p>补充一下DROP和REJECT的区别。DROP是直接把匹配到的报文丢弃，REJECT除了把报文丢弃还会给该报文中的源IP发一个ICMP报文说明目的不可达(直接回复不可达, 更强硬)。前者报文发送方只能等超时，而后者发送方因为收到了ICMP不可达所以马上就给出了提示。</p><h1 id="3-filter过滤规则"><a href="#3-filter过滤规则" class="headerlink" title="3. filter过滤规则"></a>3. filter过滤规则</h1><p>filter负责过滤功能，比如允许哪些IP地址访问，拒绝哪些IP地址访问，允许访问哪些端口，禁止访问哪些端口，filter表会根据我们定义的规则进行过滤，filter表应该是我们最常用到的表了。</p><h3 id="3-1-查看规则"><a href="#3-1-查看规则" class="headerlink" title="3.1 查看规则"></a>3.1 查看规则</h3><p>怎样查看filter表中的规则呢？使用如下命令即可查看。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t filter -L</span><br></pre></td></tr></table></figure><p>刚才提到，我们可以使用iptables -t filter -L命令列出filter表中的所有规则，那么举一反三，我们也可以查看其它表中的规则，示例如下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -t raw -L</span><br><span class="line">iptables -t mangle -L</span><br><span class="line">iptables -t nat -L</span><br></pre></td></tr></table></figure><p>其实，我们可以省略-t filter，当没有使用-t选项指定表时，默认为操作filter表，即iptables -L表示列出filter表中的所有规则。</p><h3 id="3-2-详细信息"><a href="#3-2-详细信息" class="headerlink" title="3.2 详细信息"></a>3.2 详细信息</h3><p>我们还可以只查看指定表中的指定链的规则，比如，我们只查看filter表中INPUT链的规则，示例如下（注意大小写）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables --line-numbers  -nvL INPUT</span></span><br><span class="line">Chain INPUT (policy ACCEPT 14M packets, 2062M bytes)</span><br><span class="line">num   pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">1    2697K  114M KUBE-SERVICES  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW /* kubernetes service portals */</span><br><span class="line">2    2697K  114M KUBE-EXTERNAL-SERVICES  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW /* kubernetes externally-visible service portals */</span><br><span class="line">3     906M  477G KUBE-FIREWALL  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br></pre></td></tr></table></figure><ul><li><p>头含义</p><p>上图中INPUT链后面的括号中包含policy ACCEPT ，0 packets，0bytes 三部分。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">policy:表示当前链的默认策略，policy ACCEPT表示上图中INPUT的链的默认动作为ACCEPT</span><br><span class="line">packets:表示当前链（上例为INPUT链）默认策略匹配到的包的数量，0 packets表示默认策略匹配到0个包。</span><br><span class="line">bytes:表示当前链默认策略匹配到的所有包的大小总和。</span><br></pre></td></tr></table></figure><p>其实，我们可以把packets与bytes称作”计数器”，上图中的计数器记录了默认策略匹配到的报文数量与总大小，”计数器”只会在使用-v选项时，才会显示出来。</p></li><li><p>字段含义</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pkts:对应规则匹配到的报文的个数。</span><br><span class="line">bytes:对应匹配到的报文包的大小总和。</span><br><span class="line">target:规则对应的target，往往表示规则对应的&quot;动作&quot;，即规则匹配成功后需要采取的措施。</span><br><span class="line">prot:表示规则对应的协议，是否只针对某些协议应用此规则。</span><br><span class="line">opt:表示规则对应的选项。</span><br><span class="line">in:表示数据包由哪个接口(网卡)流入，我们可以设置通过哪块网卡流入的报文需要匹配当前规则。</span><br><span class="line">out:表示数据包由哪个接口(网卡)流出，我们可以设置通过哪块网卡流出的报文需要匹配当前规则。</span><br><span class="line">source:表示规则对应的源头地址，可以是一个IP，也可以是一个网段。</span><br><span class="line">destination:表示规则对应的目标地址。可以是一个IP，也可以是一个网段。</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-3-增加规则"><a href="#3-3-增加规则" class="headerlink" title="3.3 增加规则"></a>3.3 增加规则</h3><p>为了准备一个从零开始的环境，使用<code>iptables -F INPUT</code>命令清空filter表INPUT链中的规则。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@tencent:~<span class="comment"># iptables -nvL INPUT</span></span><br><span class="line">Chain INPUT (policy ACCEPT 215 packets, 16538 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br></pre></td></tr></table></figure><p>清空INPUT链以后，filter表中的INPUT链已经不存在任何的规则，但是可以看出，INPUT链的默认策略是ACCEPT，也就是说，INPUT链默认”放行”所有发往本机的报文，当没有任何规则时，会接受所有报文，当报文没有被任何规则匹配到时，也会默认放行报文。</p><ul><li>增加</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t filter -I INPUT -s 123.117.179.97 -j DROP</span><br></pre></td></tr></table></figure><p>在目标服务器增加一条本地的 ip, 发现已经 ping不通了.</p><p>上图中，使用 -t选项指定了要操作的表，此处指定了操作filter表，与之前的查看命令一样，不使用-t选项指定表时，默认为操作filter表。<br>使用-I选项，指明将”规则”插入至哪个链中，-I表示insert，即插入的意思，所以-I INPUT表示将规则插入于INPUT链中，即添加规则之意。</p><p>使用-s选项，指明”匹配条件”中的”源地址”，即如果报文的源地址属于-s对应的地址，那么报文则满足匹配条件，-s为source之意，表示源地址。</p><p>使用-j选项，指明当”匹配条件”被满足时，所对应的动作，上例中指定的动作为DROP，在上例中，当报文的源地址为223.70.253.1时，报文则被DROP（丢弃）。</p><ul><li>查看</li></ul><p>再次查看filter表中的INPUT链，发现规则已经被添加了，在iptables中，动作被称之为”target”，所以，上图中taget字段对应的动作为DROP。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@tencent:~<span class="comment"># iptables -vL INPUT</span></span><br><span class="line">Chain INPUT (policy ACCEPT 2043 packets, 135K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination         </span><br><span class="line">   66  9796 DROP       all  --  any    any     123.117.179.97       anywhere  </span><br></pre></td></tr></table></figure><p>注意看, 可以看到 bytes 的字节数, 说明已经匹配上了.</p><ul><li>顺序</li></ul><p>规则的顺序很重要。</p><p>如果报文已经被前面的规则匹配到，iptables则会对报文执行对应的动作，即使后面的规则也能匹配到当前报文，很有可能也没有机会再对报文执行相应的动作。</p><h3 id="3-4-删除规则"><a href="#3-4-删除规则" class="headerlink" title="3.4 删除规则"></a>3.4 删除规则</h3><p>此刻，如果我们想要删除filter表中INPUT中的一条规则，该怎么做呢？有两种办法<br>方法一：根据规则的编号去删除规则<br>方法二：根据具体的匹配条件与动作删除规则</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加两种</span></span><br><span class="line">iptables -t filter -A INPUT -s 1.1.1.1 -j DROP</span><br><span class="line">iptables -t filter -A INPUT -s 1.1.1.2 -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iptables --line -nvL INPUT</span><br><span class="line">3        0     0 DROP       all  --  *      *       1.1.1.1              0.0.0.0/0           </span><br><span class="line">4        0     0 DROP       all  --  *      *       1.1.1.2              0.0.0.0/0  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两种删除方式</span></span><br><span class="line">iptables -D INPUT 3</span><br><span class="line">iptables -D INPUT -s 1.1.1.2 -j DROP</span><br></pre></td></tr></table></figure><ul><li><p>删除所有</p><p>而删除指定表中某条链中的所有规则的命令，我们在一开始就使用到了，就是”iptables -t 表名 -F 链名”<br>-F选项为flush之意，即冲刷指定的链，即删除指定链中的所有规则，但是注意，此操作相当于删除操作，在没有保存iptables规则的情况下，请慎用。</p></li></ul><h3 id="3-5-修改规则"><a href="#3-5-修改规则" class="headerlink" title="3.5 修改规则"></a>3.5 修改规则</h3><p>建议删除后再新增</p><ul><li><p>修改默认策略<br>使用-t指定要操作的表，使用-P选项指定要修改的链，下例中，<code>-P FORWARD ACCEPT</code>表示将表中FORWRD链的默认策略改为ACCEPT。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iptables --line -nvL FORWARD</span><br><span class="line">Chain FORWARD (policy DROP 0 packets, 0 bytes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行修改默认</span></span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line"></span><br><span class="line">iptables --line -nvL FORWARD</span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-6-保存规则"><a href="#3-6-保存规则" class="headerlink" title="3.6 保存规则"></a>3.6 保存规则</h3><p>在默认的情况下，我们对”防火墙”所做出的修改都是”临时的”，换句话说就是，当重启iptables服务或者重启服务器以后，我们平常添加的规则或者对规则所做出的修改都将消失，为了防止这种情况的发生，我们需要将规则”保存”。</p><ul><li><p>centos</p><p>centos6中，使用”service iptables save”命令即可保存规则，规则默认保存在&#x2F;etc&#x2F;sysconfig&#x2F;iptables文件中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables save</span><br></pre></td></tr></table></figure><p>centos7中，使用firewall替代了原来的iptables service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3000/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以安装 iptables-service</span></span><br><span class="line">yum install -y iptables-services</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl <span class="built_in">enable</span> iptables</span><br><span class="line">service iptables save</span><br></pre></td></tr></table></figure><p>还可以使用另一种方法保存iptables规则，就是使用iptables-save命令<br>使用iptables-save并不能保存当前的iptables规则，但是可以将当前的iptables规则以”保存后的格式”输出到屏幕上。可以使用iptables-save命令，再配合重定向</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line">iptables-restore &lt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure></li><li><p>ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install iptables-persistent</span><br><span class="line"></span><br><span class="line">sudo /etc/init.d/iptables-persistent save </span><br><span class="line">sudo /etc/init.d/iptables-persistent reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 16.04 Server</span></span><br><span class="line">sudo netfilter-persistent save</span><br><span class="line">sudo netfilter-persistent reload</span><br></pre></td></tr></table></figure></li></ul><h1 id="4-匹配条件"><a href="#4-匹配条件" class="headerlink" title="4. 匹配条件"></a>4. 匹配条件</h1><h3 id="4-1-匹配方式"><a href="#4-1-匹配方式" class="headerlink" title="4.1 匹配方式"></a>4.1 匹配方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单个匹配</span></span><br><span class="line">iptables -I INPUT -s 1.1.1.2 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个匹配</span></span><br><span class="line">iptables -I INPUT -s 1.1.1.3,1.1.1.4 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 网段匹配</span></span><br><span class="line">iptables -I INPUT -s 1.1.1.5/23 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取反匹配</span></span><br><span class="line">iptables -I INPUT ! -s 1.1.1.6 -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>取反注意点</li></ul><p>使用 “!” 取反后则表示，报文源地址IP只要不为1.1.1.6即满足条件，那么，上例中规则表达的意思就是，只要发往本机的报文的源地址不是1.1.1.6，就接受报文。</p><p>只要报文的源IP不是1.1.1.6，那么就接受此报文，但是，某些小伙伴可能会误会，把上例中的规则理解成如下含义，</p><p>只要报文的源IP是1.1.1.6，那么就不接受此报文，这种理解与上述理解看似差别不大，其实完全不一样，这样理解是错误的，上述理解才是正确的。</p><blockquote><p>换句话说就是，报文的源IP不是1.1.1.6时，会被接收，并不能代表，报文的源IP是1.1.1.6时，会被拒绝。</p></blockquote><h3 id="4-2-匹配IP地址"><a href="#4-2-匹配IP地址" class="headerlink" title="4.2 匹配IP地址"></a>4.2 匹配IP地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只丢弃从 1.1.1.7 发往 1.1.1.8 这个IP的报文</span></span><br><span class="line">iptables -I INPUT -s 1.1.1.7 -d 1.1.1.8 -j DROP</span><br></pre></td></tr></table></figure><p>如果我们不指定任何目标地址，则目标地址默认为0.0.0.0&#x2F;0，同理，如果我们不指定源地址，源地址默认为0.0.0.0&#x2F;0，0.0.0.0&#x2F;0表示所有IP，示例如下。</p><p>与-s选项一样，-d选项也可以使用”叹号”进行取反，也能够同时指定多个IP地址，使用”逗号”隔开即可。</p><p>但是请注意，不管是-s选项还是-d选项，取反操作与同时指定多个IP的操作不能同时使用。</p><blockquote><p>需要明确的一点就是：当一条规则中有多个匹配条件时，这多个匹配条件之间，默认存在”与”的关系。也就是取其交集的意思。</p></blockquote><h3 id="4-3-匹配协议类型"><a href="#4-3-匹配协议类型" class="headerlink" title="4.3 匹配协议类型"></a>4.3 匹配协议类型</h3><p>我们可以使用-p选项，指定需要匹配的报文的协议类型。</p><p>拒绝来自 <code>1.1.1.2</code>的tcp类型的请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -s 1.1.1.2 -p tcp -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@tencent:~<span class="comment"># iptables -L INPUT</span></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">DROP       tcp  --  1.1.1.2              anywhere</span><br></pre></td></tr></table></figure><p>centos6中，-p选项支持如下协议类型</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp, udp, udplite, icmp, esp, ah, sctp</span><br></pre></td></tr></table></figure><p>centos7中，-p选项支持如下协议类型</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp, udp, udplite, icmp, icmpv6,esp, ah, sctp, mh</span><br></pre></td></tr></table></figure><p>当不使用-p指定协议类型时，默认表示所有类型的协议都会被匹配到，与使用-p all的效果相同。</p><ul><li><p>测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ping 49.234.15.70 <span class="comment"># 服务器可以通</span></span><br><span class="line"></span><br><span class="line">ps -ef | grep sshd <span class="comment">#  获取登录者 root@pts/1</span></span><br><span class="line"><span class="built_in">who</span> -a | grep pts/0 <span class="comment"># 获取登录者ip 20816 (223.70.253.1)</span></span><br><span class="line"></span><br><span class="line">iptables -I INPUT -s 223.70.253.1 -p icmp -j DROP <span class="comment"># 服务器禁ping</span></span><br><span class="line"></span><br><span class="line">ping 49.234.15.70 <span class="comment"># 服务器不通了</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-4-匹配网卡接口"><a href="#4-4-匹配网卡接口" class="headerlink" title="4.4 匹配网卡接口"></a>4.4 匹配网卡接口</h3><ul><li>入口</li></ul><p>使用-i选项，指定网卡名称, 表示丢弃由eth0网卡流入的icmp类型的报文。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -s 223.70.253.1 -i eth0 -p icmp -j DROP</span><br></pre></td></tr></table></figure><p>-i选项是用于匹配报文流入的网卡的，也就是说，从本机发出的报文是不可能会使用到-i选项的，因为这些由本机发出的报文压根不是从网卡流入的，而是要通过网卡发出的，从这个角度考虑，-i选项的使用是有限制的。</p><p>所以-i选项只能用于上图中的PREROUTING链、INPUT链、FORWARD链，这是-i选项的特殊性。</p><ul><li>出口</li></ul><p>当主机有多块网卡时，可以使用-o选项，匹配报文将由哪块网卡流出，没错，-o选项与-i选项是相对的，-i选项用于匹配报文从哪个网卡流入，-o选项用于匹配报文将从哪个网卡流出。</p><p>-o选项只能用于FORWARD链、OUTPUT链、POSTROUTING链。</p><h3 id="4-5-匹配端口"><a href="#4-5-匹配端口" class="headerlink" title="4.5 匹配端口"></a>4.5 匹配端口</h3><p>匹配端口属于扩展匹配条件, 需要依赖一些扩展模块.</p><h5 id="4-5-1-端口-m-tcp"><a href="#4-5-1-端口-m-tcp" class="headerlink" title="4.5.1 端口 -m tcp"></a>4.5.1 端口 -m tcp</h5><p>选项–dport可以匹配报文的目标端口，–dport意为destination-port，即表示目标端口。与之前的选项不同，–dport前有两条”横杠”，而且，使用–dport选项时，必须事先指定了使用哪种协议，即必须先使用-p选项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -s 1.1.1.2 -p tcp -m tcp --dport 22 -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@tencent:~<span class="comment"># iptables -nvL INPUT</span></span><br><span class="line">Chain INPUT (policy ACCEPT 1631 packets, 1525K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 DROP       tcp  --  *      *       1.1.1.2              0.0.0.0/0            tcp dpt:22</span><br></pre></td></tr></table></figure><p>在使用–dport之前，我们使用-m选项，指定了对应的扩展模块为tcp，也就是说，如果想要使用–dport这个扩展匹配条件，则必须依靠某个扩展模块完成，上例中，这个扩展模块就是tcp扩展模块，最终，我们使用的是tcp扩展模块中的dport扩展匹配条件。</p><ul><li>-m tcp表示使用tcp扩展模块，–dport表示tcp扩展模块中的一个扩展匹配条件，可用于匹配报文的目标端口。</li><li>-p tcp与 -m tcp并不冲突，-p用于匹配报文的协议，-m 用于指定扩展模块的名称，正好，这个扩展模块也叫tcp。</li></ul><p>扩展匹配条件是可以取反的，同样是使用”!”进行取反，比如 “! –dport 22”，表示目标端口不是22的报文将会被匹配到。</p><p>代表”源端口”的扩展匹配条件为–sport, 不管是–sport还是–dsport，都能够指定一个端口范围，比如，–dport 22:25表示目标端口为22到25之间的所有端口，即22端口、23端口、24端口、25端口</p><h5 id="4-5-1-多个端口-m-multiport"><a href="#4-5-1-多个端口-m-multiport" class="headerlink" title="4.5.1 多个端口 -m multiport"></a>4.5.1 多个端口 -m multiport</h5><p>如果想要同时指定多个离散的端口，需要借助另一个扩展模块，”multiport”模块。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -s 1.1.1.2 -p tcp -m multiport --dports 22,36,80 -j DROP</span><br><span class="line"></span><br><span class="line">root@tencent:~<span class="comment"># iptables -nvL INPUT</span></span><br><span class="line">Chain INPUT (policy ACCEPT 184 packets, 109K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 DROP       tcp  --  *      *       1.1.1.2              0.0.0.0/0            multiport dports 22,36,80</span><br></pre></td></tr></table></figure></div><div class="reward-container"><div>可以加首页作者微信，咨询相关问题！</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.jpg" alt="levon 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/alipay.jpg" alt="levon 支付宝"><p>支付宝</p></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/iptables/" rel="tag"># iptables</a></div><div class="post-nav"><div class="post-nav-item"><a href="/p/709160dd.html" rel="prev" title="iCloud同步的问题"><i class="fa fa-chevron-left"></i> iCloud同步的问题</a></div><div class="post-nav-item"><a href="/p/424d5aad.html" rel="next" title="iptables使用教程02">iptables使用教程02 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-%E5%89%8D%E8%A8%80"><span class="nav-text">0. 前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0-0-%E9%98%B2%E7%81%AB%E5%A2%99"><span class="nav-text">0.0 防火墙</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0-1-iptables"><span class="nav-text">0.1 iptables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0-2-netfilter"><span class="nav-text">0.2 netfilter</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#1-iptables%E5%9F%BA%E7%A1%80"><span class="nav-text">1. iptables基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%BA%94%E9%93%BE"><span class="nav-text">1.1 五链</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-1-%E4%B8%BE%E4%BE%8B"><span class="nav-text">1.1.1 举例:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%9B%9B%E8%A1%A8"><span class="nav-text">1.2 四表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E8%A1%A8%E9%93%BE%E5%85%B3%E7%B3%BB"><span class="nav-text">1.3 表链关系</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E8%A7%84%E5%88%99"><span class="nav-text">2. 规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-text">2.1 匹配条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%A4%84%E7%90%86%E5%8A%A8%E4%BD%9C"><span class="nav-text">2.2 处理动作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-filter%E8%BF%87%E6%BB%A4%E8%A7%84%E5%88%99"><span class="nav-text">3. filter过滤规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%9F%A5%E7%9C%8B%E8%A7%84%E5%88%99"><span class="nav-text">3.1 查看规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-text">3.2 详细信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%A2%9E%E5%8A%A0%E8%A7%84%E5%88%99"><span class="nav-text">3.3 增加规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E5%88%A0%E9%99%A4%E8%A7%84%E5%88%99"><span class="nav-text">3.4 删除规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E4%BF%AE%E6%94%B9%E8%A7%84%E5%88%99"><span class="nav-text">3.5 修改规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-%E4%BF%9D%E5%AD%98%E8%A7%84%E5%88%99"><span class="nav-text">3.6 保存规则</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-text">4. 匹配条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%8C%B9%E9%85%8D%E6%96%B9%E5%BC%8F"><span class="nav-text">4.1 匹配方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%8C%B9%E9%85%8DIP%E5%9C%B0%E5%9D%80"><span class="nav-text">4.2 匹配IP地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E5%8C%B9%E9%85%8D%E5%8D%8F%E8%AE%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">4.3 匹配协议类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E5%8C%B9%E9%85%8D%E7%BD%91%E5%8D%A1%E6%8E%A5%E5%8F%A3"><span class="nav-text">4.4 匹配网卡接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E5%8C%B9%E9%85%8D%E7%AB%AF%E5%8F%A3"><span class="nav-text">4.5 匹配端口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-5-1-%E7%AB%AF%E5%8F%A3-m-tcp"><span class="nav-text">4.5.1 端口 -m tcp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-5-1-%E5%A4%9A%E4%B8%AA%E7%AB%AF%E5%8F%A3-m-multiport"><span class="nav-text">4.5.1 多个端口 -m multiport</span></a></li></ol></li></ol></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="levon" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">levon</p><div class="site-description" itemprop="description">Keep it simple, stupid.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">355</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">76</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">153</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/unix2dos" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;unix2dos" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:levonfly@gmail.com" title="E-Mail → mailto:levonfly@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://coolshell.cn/" title="https:&#x2F;&#x2F;coolshell.cn&#x2F;" rel="noopener" target="_blank">酷壳</a></li><li class="links-of-blogroll-item"><a href="https://catcoding.me/" title="https:&#x2F;&#x2F;catcoding.me&#x2F;" rel="noopener" target="_blank">程序员的喵</a></li><li class="links-of-blogroll-item"><a href="https://www.zsythink.net/" title="https:&#x2F;&#x2F;www.zsythink.net&#x2F;" rel="noopener" target="_blank">朱双印</a></li><li class="links-of-blogroll-item"><a href="https://eurychen.me/" title="https:&#x2F;&#x2F;eurychen.me&#x2F;" rel="noopener" target="_blank">东泽煮粥</a></li><li class="links-of-blogroll-item"><a href="https://luanruisong.com/" title="https:&#x2F;&#x2F;luanruisong.com&#x2F;" rel="noopener" target="_blank">anwu</a></li><li class="links-of-blogroll-item"><a href="https://io-oi.me/" title="https:&#x2F;&#x2F;io-oi.me&#x2F;" rel="noopener" target="_blank">一休儿</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备20000727号 </a><img src="/images/beian.png" style="display:inline-block"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502039978" rel="noopener" target="_blank">京公网安备11010502039978号</a></div><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">levon</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var e,t,o,n,r,a=document.getElementsByTagName("link");if(0<a.length)for(i=0;i<a.length;i++)"canonical"==a[i].rel.toLowerCase()&&a[i].href&&(e=a[i].href);t=e?e.split(":")[0]:window.location.protocol.split(":")[0],e=e||window.location.href,window,n=e,r=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(n)||(o="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",r?(o+="?r="+encodeURIComponent(document.referrer),n&&(o+="&l="+n)):n&&(o+="?l="+n),(new Image).src=o)}()</script><script src="/js/local-search.js"></script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'Y4ry1QHkYxVXKLQBrx6LJXld-gzGzoHsz',
      appKey     : 'TXITOypSvI7JO61NI8EG5exk',
      placeholder: "留下您的小脚丫吧~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html>